// Module included in the following assemblies:
//
// mounting-a-secret-as-a-file-or-an-environment-variable-into-a-workspace-container

[id="mounting-a-secret-as-a-file-into-a-workspace-container_{context}"]
= Mounting a secret as a file into a workspace container

WARNING: On 
ifeval::["{project-context}" == "che"]
{kubernetes} older than v1.13 and
endif::[]
OpenShift {ocp3-ver}, secrets mounted as files override volume mounts defined in the devfile.

In {prod-short}, you can mount the {platforms-name} secret from your {orch-namespace} as a file in single-workspace or multiple-workspace containers.

.Prerequisites

* A running instance of {prod-short}. See {link-installing-an-instance}.

.Procedure

. Create a new secret in the {platforms-namespace} where a new workspace is deployed.
. Match the `labels` of the secret to the set of labels configured in the `che.workspace.provision.secret.labels` property of {prod-short}.
. Define the default behavior for mounting secrets in the `automount-workspace-secret` annotation, which takes a string value:
** `'true'` enables automatic mounting into all workspace containers.
** `'false'` disables automatic mounting into all workspace containers. (To mount a secret, a user must request it in the devfile component by using the `automountWorkspaceSecrets:true` property.)
. Set a `mount-path` for the file.
. Include the `mount-as: file` annotation.
. Set the filename in the `data` field of the secret.
+
NOTE: The {orch-name} secret can contain several `data` items. The names of the `data` items must match the name of the secret file mounted into the container.

.Example: Mounting a secret as a file
[source,yaml,subs="+quotes,attributes"]
----
apiVersion: v1
kind: Secret
metadata:
  name: __<secret_name>__
  labels: <1>
    app.kubernetes.io/part-of: che.eclipse.org
    app.kubernetes.io/component: workspace-secret
  annotations: <2>
    che.eclipse.org/automount-workspace-secret: 'true' <3>
    che.eclipse.org/mount-path: __<path_to_file>__ <4>
    che.eclipse.org/mount-as: file <5>
data:
  __<key>__: __<base64_encoded_value>__ <6>
----
<1> DRAFT: Matches the configured default label. xref:
https://www.eclipse.org/che/docs/che-7/installation-guide/advanced-configuration-options-for-the-che-server-component/#devfile-defaults
<2> See link:https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/#syntax-and-character-set[Syntax and character set] for annotations.
<3> Enables automatic mounting into all workspace containers.
<4> Sets the mount path of the file for all workspace containers.
<5> Mounts the secret as a file.
<6> Sets the `settings.xml` file name.

include::snip_tip-annotation-name.adoc[]

.Additional resources
ifeval::["{project-context}" == "che"]
* For more information about creating secrets, see link:https://kubernetes.io/docs/concepts/configuration/secret/#creating-a-secret[Kubernetes Documentation].
endif::[]
* xref:mounting-a-secret-as-a-file-or-an-environment-variable-into-a-workspace-container.adoc#the-use-of-annotations-in-the-process-of-mounting-a-secret-into-a-workspace-container_{context}[]
* xref:installation-guide:mounting-a-secret-as-a-file-or-an-environment-variable-into-a-container.adoc[]
//overlapping content in doc xref'ed on previous line
