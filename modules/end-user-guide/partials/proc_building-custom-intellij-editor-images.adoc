[id="building-custom-intellij-editor-images_{context}"]
= Building custom IntelliJ editor images

This procedure describes how to build an IntelliJ-based editor image using a custom archive and a custom image name.

.Prerequisites

* Define the following locations to publish the editor image and metadata:
+
`__<IntelliJ-container-image>__`:: Location of the IntelliJ editor image in a registry accessible by {prod-short}.
+
`__<URL_to_meta.yaml>__`:: HTTPS resource containing the editor metadata.

* Define the build parameters:
+
`--tag __<name:tag>__`::
Tag to apply to the image after build.
+
`--url __<downloadUrl>__`::
Download URL pointing to the archive of the custom IntelliJ-based distribution, meeting following criteria: 
+
** Linux platform.
** Archive in `+tar.gz+` format.
** With JetBrains Runtime (JBR).
** Supported by Projector. The last version supported by Projector is 2020.3.
+
.Searching the download URL for IntelliJ IDEA
====
. Navigate to link:https://www.jetbrains.com/idea/download/other.html[Download IntelliJ IDEA Other Versions]
. Copy the download link for the archive: Version 2020.3, IntelliJ IDEA Community Edition, 2020.3.4 - Linux (`tar.gz`) with JBR.
====

* A Docker version supporting link:https://docs.docker.com/develop/develop-images/build_enhancements/[Docker BuildKit]. Docker 18.09 or greater.

* The `git` and `jq`tools are available.

* A Java Development Kit (JDK) version 11 is available.

* On the macOS platform: the `+gnu-getopt+` tool is available.


.Procedure

. Get a local copy of the link:https://github.com/che-incubator/jetbrains-editor-images[JetBrains Projector Editor Images repository].
+
----
$ git clone https://github.com/che-incubator/jetbrains-editor-images
$ cd jetbrains-editor-images
----

. Build the container.
+
[subs="+quotes,macros,attributes"]
----
$ ./projector build --tag __<name:tag>__ --url __<downloadUrl>__
----
+
.Building the Docker image with WebStorm 2020.3.3
====
----
$ ./projector.sh build --tag che-webstorm:latest --url https://download.jetbrains.com/webstorm/WebStorm-2020.3.3.tar.gz
----
====
+
.Building the Docker image with PyCharm Community 2020.3.5
====
----
$ ./projector.sh build --tag che-pycharm:latest --url https://download.jetbrains.com/python/pycharm-community-2020.3.5.tar.gz
----
====
+
.Building the Docker image with IntelliJ IDEA Ultimate 2020.2.2
====
----
$ ./projector.sh build --tag che-idea-ultimate:latest --url https://download.jetbrains.com/idea/ideaIU-2020.2.2.tar.gz
----
====

. To test the container, run the container locally, and navigate to `++http://localhost:8887++` to access the JetBrains IDE.
+
[subs="+quotes,macros,attributes"]
----
$ ./projector.sh run __<name:tag>__
----
+
.Testing the Docker image with WebStorm
====
----
$ ./projector.sh run che-webstorm:latest
----
====
+
.Testing the Docker image with PyCharm
====
----
$ ./projector.sh run che-pycharm:latest
----
====
+
.Testing the Docker image with IntelliJ IDEA Ultimate
====
----
$ ./projector.sh run che-idea-ultimate:latest
----
====

. Publish the container to __<IntelliJ-container-image>__.

. Create a `+meta.yaml+` file with the following content, and publish it to `__<URL_to_meta.yaml>__`:
+
[source,yaml,subs="+quotes,macros,attributes"]
----
apiVersion: v2
publisher: <username>
name: intellij-ide
version: latest
type: Che Editor
displayName: IntelliJ-based IDE
title: IntelliJ-based IDE as Editor for Eclipse Che
description: IntelliJ-based IDE running using Projector
icon: https://www.jetbrains.com/apple-touch-icon.png
category: Editor
repository: https://github.com/che-incubator/jetbrains-editor-images
firstPublicationDate: "2021-04-10"
spec:
  endpoints:
   -  name: "intellij"
      public: true
      targetPort: 8887
      attributes:
        protocol: http
        type: ide
        path: /projector-client/index.html?backgroundColor=434343&wss
  containers:
   - name: intellij-ide
     image: "__<IntelliJ-container-image>__"
     mountSources: true
     volumes:
         - mountPath: "/home/projector-user"
           name: projector-user
     ports:
         - exposedPort: 8887
     memoryLimit: "4096M"
----


.Additional resources

* xref:using-intellij-based-ides.adoc[]
* link:https://github.com/che-incubator/jetbrains-editor-images[JetBrains Projector Editor Images repository]
* link:https://docs.docker.com/develop/develop-images/build_enhancements/[Docker BuildKit]
