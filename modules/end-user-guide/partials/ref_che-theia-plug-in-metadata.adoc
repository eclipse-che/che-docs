pass:[<!-- vale Vale.Spelling = NO -->]

pass:[<!-- vale Vale.Terms = NO -->]

pass:[<!-- vale IBM.Usage = NO -->]

pass:[<!-- vale IBM.PassiveVoice = NO -->]

pass:[<!-- vale IBM.Slash = NO -->]

// This assembly is included in the following assemblies:
//
// what-is-a-che-theia-plug-in

[id="che-theia-plug-in-metadata_{context}"]
= Che-Theia plug-in metadata

Che-Theia plug-in metadata is information about individual plug-ins for the plug-in registry.

The Che-Theia plug-in metadata, for each specific plug-in, is defined in a `meta.yaml` file. These files can be referenced in a devfile to include Che-Theia plug-ins in a workspace.

Here is an overview of all fields that can be available in plug-in meta YAML files. This document represents the link:https://github.com/eclipse-che/che-plugin-registry#user-content-plugin-meta-yaml-structure[plugin meta YAML structure (version 3)].

ifeval::["{project-context}" == "che"]
In the link:https://github.com/eclipse-che/che-plugin-registry[{prod-short} plug-ins registry repository], the `che-theia-plugins.yaml` file contains a list of all Che-Theia plug-ins in the registry. Build the registry container image to generate the `meta.yaml` file.
endif::[]

.`meta.yml`
|===
|`apiVersion`| Version 2 and higher where version is 1 supported for backwards compatibility 
|`category`| Available: Category must be set to one of the followings: `Editor`, `Debugger`, `Formatter`, `Language`, `Linter`, `Snippet`, `Theme`, `Other`
|`description`| Short description of the plug-in purpose
|`displayName`| Name shown in user dashboard
|`deprecate` | Optional; section for deprecating plug-ins in favor of others

            * autoMigrate - boolean 
            
            * migrateTo - new `org/plugin-id/version`, for example `redhat/vscode-apache-camel/latest`
|`firstPublicationDate`| Not required to be in YAML; if it is not included, the plug-in registry `dockerimage` build generates it
|`latestUpdateDate`| Not required to be in YAML; if it is not included, the plug-in registry `dockerimage` build generates it
|`icon`| URL of an SVG or PNG icon
|`name`| Name (no spaces allowed), must match [-a-z0-9]
|`publisher`| Name of the publisher, must match [-a-z0-9]
|`repository`| URL for plug-in repository, for example, GitHub
|`title`|  Plug-in title (long)
|`type`| `Che Plugin`, `Visual Studio Code extension`
|`version`| Version information, for example: 7.5.1, [-.a-z0-9]
|`spec`| Specifications (see below)
|===

.`spec` attributes
|===
|`endpoints` | Optional; plug-in endpoint
|`containers`| Optional; sidecar containers for the plug-in. Che Plug-in and Visual Studio Code extension supports only one container
|`initContainers`| Optional; sidecar init containers for the plug-in
|`workspaceEnv`| Optional; environment variables for the workspace
|`extensions`| Optional; Attribute that is required for Visual Studio Code and Che-Theia plug-ins in a form list of URLs to plug-in artefacts, such as .vsix or .theia files
|===

.`spec.containers`. Notice: `spec.initContainers` has absolutely the same container definition.
|===
|`name` | Sidecar container name
|`image` | Absolute or relative container image URL 
|`memoryLimit` | OpenShift memory limit string, for example `512Mi`
|`memoryRequest` | OpenShift memory request string, for example `512Mi`
|`cpuLimit` | OpenShift CPU limit string, for example `2500m`
|`cpuRequest` | OpenShift CPU request string, for example `125m`
|`env` | List of environment variables to set in the sidecar
|`command` | String array definition of the root process command in the container
|`args` | String array arguments for the root process command in the container
|`volumes` | Volumes required by the plug-in
|`ports` | Ports exposed by the plug-in (on the container)
|`commands` | Development commands available to the plug-in container
|`mountSources` | Boolean flag to bound volume with source code `/projects` to the plug-in container
|`initContainers` | Optional; init containers for sidecar plug-in
|`Lifecycle` | Container lifecycle hooks. See link:https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/[`lifecycle` description]
|===

.`spec.containers.env` and `spec.initContainers.env` attributes. Notice:  `workspaceEnv` has absolutely the same attributes
|===
|`name`| Environment variable name
|`value`| Environment variable value
|===

.`spec.containers.volumes` and `spec.initContainers.volumes` attributes
:===
`mountPath`: Path to the volume in the container
`name`: Volume name
`ephemeral`: If true, the volume is ephemeral, otherwise the volume is persisted
:===

.`spec.containers.ports` and `spec.initContainers.ports` attributes
:===
`exposedPort`: Exposed port
:===

.`spec.containers.commands` and `spec.initContainers.commands` attributes
:===
`name`: Command name
`workingDir`: Command working directory
`command`: String array that defines the development command
:===

.`spec.endpoints` attributes
:===
`name`: Name (no spaces allowed), must match [-a-z0-9]
`public`: `true`, `false`
`targetPort`: Target port
`attributes`: Endpoint attributes
:===

.`spec.endpoints.attributes` attributes
:===
`protocol`: Protocol, example\: `ws`
`type`: `ide`, `ide-dev`
`discoverable`: `true`, `false`
`secure`: `true`, `false`. If `true`, then the endpoint is assumed to listen solely on `127.0.0.1` and is exposed using a JWT proxy
`cookiesAuthEnabled`: `true`, `false`
`requireSubdomain`: `true`, `false`. If `true`, the endpoint is exposed on subdomain in single-host mode.
:===

.`spec.containers.lifecycle` and `spec.initContainers.lifecycle` attributes
|===
|`postStart` | The `postStart` event that runs immediately after a Container is started. See link:https://kubernetes.io/docs/tasks/configure-pod-container/attach-handler-lifecycle-event/[postStart and preStop handlers] 

* `exec`: Executes a specific command, resources consumed by the command are counted against the Container 

* `command`: `["/bin/sh", "-c", "/bin/post-start.sh"]`
|`preStop` | The `preStop` event that runs before a Container is terminated. See link:https://kubernetes.io/docs/tasks/configure-pod-container/attach-handler-lifecycle-event/[postStart and preStop handlers]
 
* `exec`: Executes a specific command, resources consumed by the command are counted against the Container 

* `command`: `["/bin/sh", "-c", "/bin/post-start.sh"]`
|===

.Example `meta.yaml` for a Che-Theia plug-in: the {prod-short} machine-exec Service
[source,yaml,subs="+quotes,+attributes"]
----
  apiVersion: v2
  publisher: eclipse
  name: che-machine-exec-plugin
  version: 7.9.2
  type: Che Plugin
  displayName: {prod-short} machine-exec Service
  title: Che machine-exec Service Plugin
  description: {prod-short} Plug-in with che-machine-exec service to provide creation terminal
    or tasks for Eclipse CHE workspace containers.
  icon: https://www.eclipse.org/che/images/logo-eclipseche.svg
  repository: https://github.com/eclipse-che/che-machine-exec/
  firstPublicationDate: "2020-03-18"
  category: Other
  spec:
    endpoints:
     -  name: "che-machine-exec"
        public: true
        targetPort: 4444
        attributes:
          protocol: ws
          type: terminal
          discoverable: false
          secure: true
          cookiesAuthEnabled: true
    containers:
     - name: che-machine-exec
       image: "quay.io/eclipse/che-machine-exec:7.9.2"
       ports:
         - exposedPort: 4444
       command: ['/go/bin/che-machine-exec', '--static', '/cloud-shell', '--url', '127.0.0.1:4444']
----

.Example `meta.yaml` for a Visual Studio Code extension: the AsciiDoc support extension
[source,yaml]
----
apiVersion: v2
category: Language
description: This extension provides a live preview, syntax highlighting and snippets for the AsciiDoc format using Asciidoctor flavor
displayName: AsciiDoc support
firstPublicationDate: "2019-12-02"
icon: https://www.eclipse.org/che/images/logo-eclipseche.svg
name: vscode-asciidoctor
publisher: joaompinto
repository: https://github.com/asciidoctor/asciidoctor-vscode
title: AsciiDoctor Plug-in
type: Visual Studio Code extension
version: 2.7.7
spec:
  extensions:
  - https://github.com/asciidoctor/asciidoctor-vscode/releases/download/v2.7.7/asciidoctor-vscode-2.7.7.vsix
----

pass:[<!-- vale Vale.Spelling = YES -->]

pass:[<!-- vale Vale.Terms = YES -->]

pass:[<!-- vale IBM.Usage = YES -->]

pass:[<!-- vale IBM.PassiveVoice = YES -->]

pass:[<!-- vale IBM.Slash = YES -->]
