:_content-type: PROCEDURE
:description: Using a Git-provider access token
:keywords: Git, credentials, access-token
:navtitle: Using a Git-provider access token
:page-aliases: using-a-Git-credentials-store.adoc, using-git-credentials.adoc, 

[id="using-a-git-provider-access-token"]
= Using a Git-provider access token

OAuth for GitHub, GitLab, or Bitbucket needs to be xref:administration-guide:oauth-for-github-gitlab-or-bitbucket.adoc[configured by the administrator] of your organization's {prod-short} instance. If the administrator has not configured it for {prod-short} users, alternatively you can apply your personal access token as a {kubernetes} Secret.

Mounting your access token as a Secret enables the {prod-short} Server to access the remote repository that is cloned during workspace creation, including access to the repository's `/.che` and `/.vscode` folders.

Apply the {kubernetes} Secret in your user {orch-namespace} of the {orch-name} cluster of your organization's {prod-short} instance.

After you have applied the Secret, you can create new workspaces from a private GitHub, GitLab, or Bitbucket-server repository.

TIP: In your user {orch-namespace}, you can create and apply multiple access-token Secrets per a Git provider.

.Prerequisites

* An active `{orch-cli}` session, with administrative permissions, to the {orch-name} cluster. See {orch-cli-link}.

* The link:https://www.gnu.org/software/coreutils/base64[`base64`] command line tools are installed in the operating system you are using.

.Procedure

. Copy your access token and encode it to Base64.
+
[source,terminal,subs="+quotes,+attributes"]
----
$ echo -n '__<your_access_token>__' | base64
----

. Visit `pass:c,a,q[{prod-url}]/api/user` in the web browser and copy the `id` value from the response. This is your {prod-short} user ID.

. Get your Git provider user ID by following the Git provider's API documentation:
+
* GitHub: link:https://docs.github.com/en/rest/users/users#get-a-user[Get a user]. See the `id` value in the response.
* GitLab: link:https://docs.gitlab.com/ee/api/users.html#for-normal-users[List users: For normal users], use the `username` filter: `/users?username=:username`. See the `id` value in the response.
* Bitbucket Server: link:https://developer.atlassian.com/server/bitbucket/rest/v802/api-group-api/#api-api-latest-users-userslug-get[Get users]. See the `id` value in the response.

. Prepare a new {orch-name} Secret in your user {orch-namespace}.
+
[source,yaml,subs="+quotes,+attributes,+macros"]
----
kind: Secret
apiVersion: v1
metadata:
  name: personal-access-token-__<your_chosen_name_for_this_token>__
  labels:
    app.kubernetes.io/component: scm-personal-access-token
    app.kubernetes.io/part-of: che.eclipse.org
  annotations:
    che.eclipse.org/che-userid: _<{prod-id-short}_user_ID>_ <1>
    che.eclipse.org/scm-personal-access-token-name: _<git_provider_name>_ <2>
    che.eclipse.org/scm-url: _<Git_provider_endpoint>_ <3>
    che.eclipse.org/scm-userid: _<Git_provider_user_ID>_ <4>
    che.eclipse.org/scm-username: _<Git_provider_username>_
data:
  token: __<Base64_encoded_access_token>__
type: Opaque
----
+
<1> Your {prod-short} user ID.
<2> The Git provider name: `github` or `gitlab` or `bitbucket-server`.
<3> The Git provider URL.
<4> Your Git provider user ID.

. Verify that you are in your {prod-short} user namespace in the {orch-name} cluster.
+
[TIP]
====
* Visiting `pass:c,a,q[{prod-url}]/api/kubernetes/namespace` returns your {prod-short} user namespace as `name`.

* The `{orch-cli}` tool can return the namespace you are currently on in the {orch-name} cluster:
+
[source,subs="+attributes"]
----
$ {orch-cli} project
----

* If needed, switch to your your {prod-short} user namespace:
+
[source,subs="+quotes,+attributes"]
----
$ {orch-cli} project <your_user_namespace>
----
====

. Apply the Secret.
+
[source,subs="+quotes,+attributes"]
----
$ {orch-cli} apply -f - <<EOF
__<Secret_prepared_in_the_previous_step>__
EOF
----

.Verification

. Start a new workspace by using the URL of a Git repository that is hosted by that Git provider.
. Push to the Git repository from the workspace.
