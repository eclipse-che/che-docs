:_content-type: PROCEDURE
:description: Running Open VSX On-Premises
:keywords: administration guide, configuring, openvsx, registry
:navtitle: Running Open VSX On-Premises
:page-aliases:

[id="running-the-open-vsx-on-premises"]
= Running the Open VSX On-Premises

Follow the instructions below to deploy and configure an on-premises Eclipse Open VSX extension registry, fully integrated with {prod-short} and OpenShift environments. Choose one of the two setup paths: using a {prod-short} workspace or the OpenShift CLI (`oc`), to help you set up a secure, internal Open VSX instance. This includes creating necessary OpenShift project, deploying Open VSX components, publishing extensions and integrating the registry with {prod-short}.

== Using {prod-short} instance

.Prerequisites

* Be logged in to a {prod-short} as an administrator.

.Procedure

. Start a workspace using the Open VSX repository.
+
Create a workspace by using the following link:https://github.com/eclipse/openvsx[Eclipse Open VSX repository].
+
[TIP]
====
The environment, including all necessary commands, is defined in the `.devfile.yaml` file.
====

. Create a new OpenShift project for Open VSX.
+
Run `2.1. Create Namespace for OpenVSX` task in the workspace (`Terminal → Run Task… → devfile → 2.1. Create Namespace for OpenVSX`). A new project with the name `openvsx` should be created on the cluster.

include::example$snip_{project-context}-deploy-open-vsx.adoc[]

. Add Open VSX user with PAT to the database.
+
Run the `2.5. Add OpenVSX user with PAT to the DB` task in the workspace (`Terminal → Run Task… → devfile → 2.5. Add OpenVSX user with PAT to the DB`). The command will ask for the Open VSX username and user PAT. You can just click enter to use the default values. 
+
[IMPORTANT]
====

The user PAT must match the decoded value of `OVSX_PAT_BASE64` specified in the deployment file. If `OVSX_PAT_BASE64` has been updated, use the new token's decoded value as the user PAT.

====

. Configure {prod-short} to use the internal Open VSX.
+
Run the `2.6. Configure Che to use the internal Open VSX registry` task in the workspace (`Terminal → Run Task… → devfile → 2.6. Configure Che to use the internal OpenVSX registry`). It applies the patch to the `CheCluster` custom resource, updating its configuration to use the specified Open VSX URL for the extension registry.

.  Publish an extension from a `.vsix` file.
+
At the beginning, the Open VSX registry does not provide any extension. Once the `openvsx-server` pod is running and in the Ready state, extensions can be published to the registry. The `2.8. Publish a Visual Studio Code Extension from a VSIX file` command publishes an extension to the local Open VSX registry directly from a `.vsix` file. It prompts you to provide the extension's `namespace` name and the path to the `.vsix` file. 

.  Publish list of extensions.
+
The `2.9. Publish list of Visual Studio Code Extensions` command automates the process of publishing a predefined list of Microsoft Visual Studio Code extensions based on download URLs to the internal Open VSX registry. 
+
[TIP]
====
The command reads from the `deploy/openshift/extensions.txt` file, which lists the URLs of `.vsix` files for each extension to be published.
To publish your extensions to Open VSX, update the `extensions.txt` file as needed, then run the 2.9. Publish list of Visual Studio Code Extensions task from the workspace:
`Terminal → Run Task… → devfile → 2.9. Publish list of Visual Studio Code Extensions`.
====

. Verify that {prod-short} uses internal Open VSX.
+
Start any workspace and check the available extensions in the Extensions view of the workspace IDE or by opening the `internal` route in the OpenVSX OpenShift project.

== Using OpenShift CLI (`oc`) tool

.Prerequisites

include::example$snip_{project-context}-deploy-open-vsx-using-oc.adoc[]
+
.. Download the .vsix extension:
+ 
[bash,subs="verbatim",options="nowrap"]
----
oc exec -n openvsx "${OVSX_POD_NAME}" -- bash -c "wget -O /tmp/extension.vsix EXTENSION_DOWNLOAD_URL "
----
+
.. Create an extension namespace:
+
[bash,subs="verbatim",options="nowrap"]
---- 
oc exec -n openvsx "${OVSX_POD_NAME}" -- bash -c "ovsx create-namespace EXTENSION_NAMESPACE_NAME" || true
----
+
.. Publish the extension:
+
[bash,subs="verbatim",options="nowrap"]
----
oc exec -n openvsx "${OVSX_POD_NAME}" -- bash -c "ovsx publish /tmp/extension.vsix"
----
+
.. Delete the downloaded extension file:
+ 
[bash,subs="verbatim",options="nowrap"]
----
oc exec -n openvsx "${OVSX_POD_NAME}" -- bash -c "rm /tmp/extension.vsix"
----
+
[TIP]
====

Example: Publish the `redhat.vscode-yaml` extension version 1.18.0:
[bash,subs="verbatim",options="nowrap"]
----
oc exec -n openvsx "${OVSX_POD_NAME}" -- bash -c "wget -O /tmp/extension.vsix https://open-vsx.org/api/redhat/vscode-yaml/1.18.0/file/redhat.vscode-yaml-1.18.0.vsix " &&
oc exec -n openvsx "${OVSX_POD_NAME}" -- bash -c "ovsx create-namespace redhat" || true &&
oc exec -n openvsx "${OVSX_POD_NAME}" -- bash -c "ovsx publish /tmp/extension.vsix" &&
oc exec -n openvsx "${OVSX_POD_NAME}" -- bash -c "rm /tmp/extension.vsix"
----

====
+
. Verify Open VSX extension registry.
+
Check the list of published extensions by navigating to the URL defined in the OPENVSX_ROUTE_URL environment variable.

== Setting Up Internal Access to the Open VSX Service

In addition to using a public route to reference the Open VSX registry, you can also configure {prod-short} to set internal cluster service routing. This method provides enhanced security by keeping traffic confined within the cluster, avoiding public exposure.

.Procedure

Steps for Internal Service Routing:

. Remove the Public Route.
+
Delete the public route associated with the Open VSX registry to restrict external access:
+ 
[bash,subs="verbatim",options="nowrap"]
----
oc delete route internal -n openvsx
----

. Set the Internal Open VSX Service URL.
+
Update the CheCluster custom resource to use the internal cluster service DNS:
+ 
[bash,subs="verbatim",options="nowrap"]
----
export CHECLUSTER_NAME="$(oc get checluster --all-namespaces -o json | jq -r '.items[0].metadata.name')" &&
export CHECLUSTER_NAMESPACE="$(oc get checluster --all-namespaces -o json | jq -r '.items[0].metadata.namespace')" &&
export PATCH='{"spec":{"components":{"pluginRegistry":{"openVSXURL":"http://openvsx-server.openvsx.svc:8080"}}}}' &&
oc patch checluster "${CHECLUSTER_NAME}" --type=merge --patch "${PATCH}" -n "${CHECLUSTER_NAMESPACE}"
----

.Additional resources
* link:https://github.com/eclipse/openvsx/[Eclipse Open VSX sources]
* link:https://github.com/eclipse/openvsx/wiki/[Eclipse Open VSX documentation]
