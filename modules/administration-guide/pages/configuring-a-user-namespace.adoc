:_content-type: PROCEDURE
:description: Configuring a user namespace
:keywords: administration guide, configuring, user, namespace
:navtitle: Configuring a user namespace
:page-aliases:

[id="configuring-a-user-namespace"]
= Configuring a user namespace

Learn how to use {prod-short}
to synchronize `ConfigMaps`, `Secrets`, `PersistentVolumeClaim` and other {kubernetes} objects
from `{prod-namespace}` namespace to numerous user-specific namespaces.
The {prod-short} automates the synchronization of important configuration data, such as
shared credentials, configuration files, and certificates to user namespaces.

If you make changes to a {kubernetes} resource in an {prod-namespace} namespace,
{prod-short} will immediately synchronize the changes across all users namespaces.
In reverse, if a {kubernetes} resource is modified in a user namespace,
{prod-short} will immediately revert the changes.

.Procedure

. Create the `ConfigMap` below to create and mount it into every workspace.
+
====
[source,yaml,subs="+attributes,+quotes"]
----
kind: ConfigMap
apiVersion: v1
metadata:
  name: {prod-id-short}-user-configmap
  namespace: {prod-namespace}
  labels:
    app.kubernetes.io/part-of: che.eclipse.org
    app.kubernetes.io/component: workspaces-config
data:
  ...
----
====
To enhance the configurability, you can customize the `ConfigMap` by adding additional labels and annotations.
+
Add the following labels if you do not want the ConfigMap to be mounted automatically:
+
[source,yaml,subs="+attributes,+quotes"]
----
controller.devfile.io/watch-configmap: "false"
controller.devfile.io/mount-to-devworkspace: "false"
----
+
Add the annotation below if you want the ConfigMap to be retained in a user {namespace}
after being deleted from {prod-namespace} namespace:
+
[source,yaml,subs="+attributes,+quotes"]
----
che.eclipse.org/sync-retain-on-delete: "true"
----
For example, to mount a default SSH Config into every workspace, you need to create the ConfigMap:
+
====
[source,yaml,subs="+attributes,+quotes"]
----
kind: ConfigMap
apiVersion: v1
metadata:
  name: ssh-config-configmap
  namespace: eclipse-che
  labels:
    app.kubernetes.io/component: workspaces-config
    app.kubernetes.io/part-of: che.eclipse.org
  annotations:
    controller.devfile.io/mount-as: subpath
    controller.devfile.io/mount-path: /etc/ssh/ssh_config.d/
data:
  ssh.conf: <ssh config content>
----
====
+
This ConfigMap will propagate the SSH Config as an extension to the existing default SSH Config by the `Include /etc/ssh/ssh_config.d/*.conf` argument, see: link:https://man.openbsd.org/ssh_config#Include[].
+
See the link:https://github.com/devfile/devworkspace-operator/blob/main/docs/additional-configuration.adoc#automatically-mounting-volumes-configmaps-and-secrets[mounting volumes, configmaps, and secrets]
for other possible labels and annotations.


. Create the `Secret` below to create and mount it into every workspace.
+
====
[source,yaml,subs="+attributes,+quotes"]
----
kind: Secret
apiVersion: v1
metadata:
  name: {prod-id-short}-user-secret
  namespace: {prod-namespace}
  labels:
    app.kubernetes.io/part-of: che.eclipse.org
    app.kubernetes.io/component: workspaces-config
stringData:
    ...
----
====
To enhance the configurability, you can customize the `Secret` by adding additional labels and annotations.
+
Add the labels if you do not want the Secret to be mounted automatically:
+
[source,yaml,subs="+attributes,+quotes"]
----
controller.devfile.io/watch-secret: "false"
controller.devfile.io/mount-to-devworkspace: "false"
----
+
Add the annotation below if you want the Secret to be retained in a user {namespace}
after being deleted from {prod-namespace} namespace:
+
[source,yaml,subs="+attributes,+quotes"]
----
che.eclipse.org/sync-retain-on-delete: "true"
----
+
See the link:https://github.com/devfile/devworkspace-operator/blob/main/docs/additional-configuration.adoc#automatically-mounting-volumes-configmaps-and-secrets[mounting volumes, configmaps, and secrets]
for other possible labels and annotations.


. Create the `PersistentVolumeClaim` below to create it to every user {orch-namespace}.
+
[source,yaml,subs="+attributes,+quotes"]
----
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {prod-id-short}-user-pvc
  namespace: {prod-namespace}
  labels:
    app.kubernetes.io/part-of: che.eclipse.org
    app.kubernetes.io/component: workspaces-config
spec:
  ...
----
+
To enhance the configurability, you can customize the `PersistentVolumeClaim` by adding additional labels and annotations.
+
The `PersistentVolumeClaim` is not deleted in a user {namespace} by default, if the one from {prod-namespace} is deleted.
Add the annotation below if you want the `PersistentVolumeClaim` to be deleted in a user {namespace} as well:

+
[source,yaml,subs="+attributes,+quotes"]
----
che.eclipse.org/sync-retain-on-delete: "false"
----
+
See the link:https://github.com/devfile/devworkspace-operator/blob/main/docs/additional-configuration.adoc#automatically-mounting-volumes-configmaps-and-secrets[mounting volumes, configmaps, and secrets]
for other possible labels and annotations.
+

. To leverage the OpenShift Kubernetes Engine, you can create a `Template` object to replicate all resources defined within the template across each user {orch-namespace}.
+
Aside from the previously mentioned `ConfigMap`, `Secret`, and `PersistentVolumeClaim`, `Template` objects can include:
+
* `LimitRange`
* `NetworkPolicy`
* `ResourceQuota`
* `Role`
* `RoleBinding`
+
[source,yaml,subs="+attributes,+quotes"]
----
apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: {prod-id-short}-user-namespace-configurator
  namespace: {prod-namespace}
  labels:
    app.kubernetes.io/part-of: che.eclipse.org
    app.kubernetes.io/component: workspaces-config
objects:
  ...
parameters:
- name: PROJECT_NAME
- name: PROJECT_ADMIN_USER

----
+
The `parameters` are optional and define which parameters can be used. Currently, only `PROJECT_NAME` and `PROJECT_ADMIN_USER` are supported. `PROJECT_NAME` is the name of the {prod-short} {namespace}, while `PROJECT_ADMIN_USER` is the {prod-short} user of the {namespace}.
+
The {namespace} name in objects will be replaced with the user's {namespace} name during synchronization.
+
.Replicating {kubernetes} resources to a user {orch-namespace}:
====
[source,yaml,subs="+attributes,+quotes"]
----
apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: {prod-id-short}-user-namespace-configurator
  namespace: {prod-namespace}
  labels:
    app.kubernetes.io/part-of: che.eclipse.org
    app.kubernetes.io/component: workspaces-config
objects:
- apiVersion: v1
  kind: ResourceQuota
  metadata:
    name: {prod-id-short}-user-resource-quota
  spec:
    ...
- apiVersion: v1
  kind: LimitRange
  metadata:
    name: {prod-id-short}-user-resource-constraint
  spec:
    ...
- apiVersion: rbac.authorization.k8s.io/v1
  kind: Role
  metadata:
    name: {prod-id-short}-user-roles
  rules:
    ...
- apiVersion: rbac.authorization.k8s.io/v1
  kind: RoleBinding
  metadata:
    name: {prod-id-short}-user-rolebinding
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: {prod-id-short}-user-roles
  subjects:
  - kind: User
    apiGroup: rbac.authorization.k8s.io
    name: $\{PROJECT_ADMIN_USER}
parameters:
- name: PROJECT_ADMIN_USER
----
NOTE: Creating Template Kubernetes resources is supported only on OpenShift.
====

.Additional resources
* xref:end-user-guide:mounting-configmaps.adoc[]
* xref:end-user-guide:mounting-secrets.adoc[]
* xref:end-user-guide:requesting-persistent-storage-for-workspaces.adoc[]
* link:https://github.com/devfile/devworkspace-operator/blob/main/docs/additional-configuration.adoc#automatically-mounting-volumes-configmaps-and-secrets[Automatically mounting volumes, configmaps, and secrets]
* link:https://docs.openshift.com/container-platform/latest/rest_api/template_apis/template-template-openshift-io-v1.html[OpenShift API reference for `Template`]
* link:https://docs.openshift.com/container-platform/latest/applications/projects/configuring-project-creation.html[Configuring OpenShift project creation]