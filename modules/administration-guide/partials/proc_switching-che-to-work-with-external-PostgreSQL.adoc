// deploying-the-registries

[id="switching-{prod-id-short}-to-work-with-external-PostgreSQL_{context}"]
= Switching {prod-short} to work with an external PostgreSQL

.Procedure

include::partial$snip_scaling-down-operator.adoc[]

. Create a secret to store {prod-short} server database credentials:
+
[subs="+quotes,attributes"]
----
$ {orch-cli} create secret generic <server-database-credentials> \ <1>
--from-literal=user=<database-user> \                            <2>
--from-literal=password=<database-password> \                    <3>
-n {prod-namespace}
----
<1> Secret name to store {prod-short} server database credentials
<2> {prod-short} server database username
<3> {prod-short} server database password

. Create a secret to store {identity-provider} database credentials:
+
[subs="+quotes,attributes"]
----
$ {orch-cli} create secret generic <identity-database-credentials> \ <1>
--from-literal=password=<identity-database-password> \             <2>
-n {prod-namespace}
----
<1> Secret name to store {identity-provider} database credentials
<2> {identity-provider} database password

. Update {prod-checluster} custom resource
+
[subs="+quotes,attributes"]
----
$ oc patch checluster/{prod-checluster} -n {prod-namespace} --type=json \
  -p '[{"op": "replace", "path": "/spec/database/externalDb", "value": true}]'

$ oc patch checluster/{prod-checluster} -n {prod-namespace} --type=json \
  -p '[{"op": "replace", "path": "/spec/database/chePostgresHostName", "value": __<hostname>__}]' <1>

$ oc patch checluster/{prod-checluster} -n {prod-namespace} --type=json \
  -p '[{"op": "replace", "path": "/spec/database/chePostgresPort", "value": __<port>__}]' <2>

$ oc patch checluster/{prod-checluster} -n {prod-namespace} --type=json \
  -p '[{"op": "replace", "path": "/spec/database/chePostgresSecret", "value": __<server-database-credentials>__}]' <3>

$ oc patch checluster/{prod-checluster} -n {prod-namespace} --type=json \
  -p '[{"op": "replace", "path": "/spec/database/chePostgresDb", "value": __<database> __}]' <4>

$ oc patch checluster/{prod-checluster} -n {prod-namespace} --type=json \
  -p '[{"op": "replace", "path": "/spec/auth/identityProviderPostgresSecret", "value": __<identity-database-credentials> __}]' <5>
----
<1> External database host name
<2> External database port
<3> Secret name with {prod-short} server database credentials
<4> {prod-short} server database name
<5> Secret name with {identity-provider} database credentials

include::partial$snip_scaling-up-operator.adoc[]
