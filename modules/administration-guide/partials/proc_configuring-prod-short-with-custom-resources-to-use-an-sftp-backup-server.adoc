[id="configuring-prod-short-with-custom-resources-to-use-an-sftp-backup-server_{context}"]
= Configuring {prod-short} with custom resouces to use an SFTP backup server

To configure {prod-short} to use an SFTP backup server:

.Prerequisites

* Configured backup server. See xref:supported-restic-compatible-backup-servers.adoc[]
* Backup repository. See link:https://restic.readthedocs.io/en/latest/030_preparing_a_new_repo.html[Preparing a new repository].
* Password for the backup repository. See link:https://restic.readthedocs.io/en/latest/030_preparing_a_new_repo.html[Preparing a new repository].

.Procedure

. Create the `CheBackupServerConfiguration` custom resource object in the {prod-namespace} namespace.
+
[source,yaml,subs="+quotes,+attributes"]
----
apiVersion: org.eclipse.che/v1
kind: CheBackupServerConfiguration
metadata:
  name: backup-server-configuration
spec:
  awss3:
    username: user <1>
    hostname: my-domain.net <2>
    port: 1234 <3>
    repositoryPath: {prod-id}-backups <4>
    repositoryPasswordSecretRef: backup-encryption-password-secret <5>
    sshKeySecretRef: ssh-key-secret <6>
----
<1> User name on the remote server to login with using the SSH protocol.
<2> Remote server hostname.
<3> Optional property that specifies the port on which an SFTP server is running. The default value is `22`.
<4> Absolute or relative path on the server where backup snapshots are stored.
<5> The name of the secret containing a repository password, stored in the `repo-password` field. If the secret contains only one field, this name is arbitrary. The password is used to encrypt and decrypt backup snapshots data.
<6> The name of the secret containing a private SSH key, stored in the `ssh-privatekey` field. This SSH key can be used to perform a login without a password on an SFTP server.
+
NOTE: The Custom Resource object, stored in the `{prod-namespace}` namespace, must have only one section configured in the `spec` property.

. To configure multiple backup servers, create a separate `CheBackupServerConfiguration` custom resource object for each backup server.