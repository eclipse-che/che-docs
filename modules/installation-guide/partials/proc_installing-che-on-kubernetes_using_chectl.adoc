// Module included in the following assemblies:
//
// installing-{prod-id-short}-on-google-cloud-platform
// installing-{prod-id-short}-on-aws
// installing-{prod-id-short}-on-microsoft-azure

[id="installing-{prod-id-short}-on-kubernetes-using-{prod-cli}_{context}"]
= Installing {prod-short} on {kubernetes} using {prod-cli}

Kubernetes is an open source system for automating deployment, scaling, and managing containerized applications. The following section describes the process of deploying {prod-short} on {kubernetes} by using the `{prod-cli}` tool.

.Prerequisites

* The `{prod-cli}` management tool is available. See xref:using-the-chectl-management-tool.adoc[].

.Procedure

. Install {prod-short} on {kubernetes}:
+
[subs="+attributes"]
----
$ {prod-cli} server:deploy --platform=k8s --domain={domain}
â€º Current Kubernetes context: 'current-context'
  âœ” Verify Kubernetes API...OK
  âœ” ğŸ‘€  Looking for an already existing Eclipse Che instance
    âœ” Verify if Eclipse Che is deployed into namespace "{prod-namespace}"...it is not
  âœ” âœˆï¸  Kubernetes preflight checklist
    âœ” Verify if kubectl is installed
    âœ” Verify remote kubernetes status...done.
    âœ” Check Kubernetes version: Found v1.22.2.
    âœ” Verify domain is set...set to {domain}.
    â†“ Check if cluster accessible [skipped]
  âœ” Following Eclipse Che logs
    âœ” Start following Operator logs...done
    âœ” Start following Eclipse Che Server logs...done
    âœ” Start following PostgreSQL logs...done
    âœ” Start following Keycloak logs...done
    âœ” Start following Plug-in Registry logs...done
    âœ” Start following Devfile Registry logs...done
    âœ” Start following Eclipse Che Dashboard logs...done
    âœ” Start following namespace events...done
 â€º   Warning: Consider using the more reliable 'OLM' installer when deploying a stable release of Eclipse Che (--installer=olm).
  âœ” Create Namespace {prod-namespace}...[Exists]
  âœ” ğŸƒâ€  Running the Eclipse Che operator
    âœ” Create ServiceAccount che-operator in namespace {prod-namespace}...done.
    âœ” Read Roles and Bindings...done.
    âœ” Creating Roles and Bindings...done.
    âœ” Create CRD checlusters.org.eclipse.che...done.
    âœ” Create backup and restore CRDs...done.
    âœ” Waiting 5 seconds for the new Kubernetes resources to get flushed...done.
    âœ” Create deployment che-operator in namespace {prod-namespace}...done.
    âœ” Operator pod bootstrap
      âœ” Scheduling...done
      âœ” Downloading images...done
      âœ” Starting...done
    âœ” Prepare Eclipse Che cluster CR...Done.
    âœ” Create the Custom Resource of type checlusters.org.eclipse.che in the namespace {prod-namespace}...done.
  âœ” âœ…  Post installation checklist
    âœ” PostgreSQL pod bootstrap
      âœ” Scheduling...done
      âœ” Downloading images...done
      âœ” Starting...done
    âœ” Keycloak pod bootstrap
      âœ” Scheduling...done
      âœ” Downloading images...done
      âœ” Starting...done
    âœ” Devfile Registry pod bootstrap
      âœ” Scheduling...done
      âœ” Downloading images...done
      âœ” Starting...done
    âœ” Plug-in Registry pod bootstrap
      âœ” Scheduling...done
      âœ” Downloading images...done
      âœ” Starting...done
    âœ” Eclipse Che Dashboard pod bootstrap
      âœ” Scheduling...done
      âœ” Downloading images...done
      âœ” Starting...done
    âœ” Eclipse Che Server pod bootstrap
      âœ” Scheduling...done
      âœ” Downloading images...done
      âœ” Starting...done
    âœ” Eclipse Che status check...done
  âœ” Retrieving Che self-signed CA certificate...OK
  âœ” Prepare post installation output...done
  âœ” Show important messages
    âœ” {prod} {prod-ver} has been successfully deployed.
    âœ” Documentation             : {prod-docs-url}
    âœ” -------------------------------------------------------------------------------
    âœ” Users Dashboard           : https://{prod-namespace}-{prod-namespace}.{domain}
    âœ” Admin user login          : "XXX:XXX". NOTE: must change after first login.
    âœ” -------------------------------------------------------------------------------
    âœ” Plug-in Registry          : https://plugin-registry-{prod-namespace}.{domain}/v3
    âœ” Devfile Registry          : https://devfile-registry-{prod-namespace}.{domain}
    âœ” -------------------------------------------------------------------------------
    âœ” Identity Provider URL     : https://keycloak-{prod-namespace}.{domain}/auth
    âœ” Identity Provider login   : "XXX:XXX".
    âœ” -------------------------------------------------------------------------------
    âœ” [ACTION REQUIRED] Please add Che self-signed CA certificate into your browser: /tmp/cheCA.crt.
   Documentation how to add a CA certificate into a browser: https://www.eclipse.org/che/docs/che-7/end-user-guide/importing-certificates-to-browsers/
Command server:deploy has completed successfully in 04:25.
----

.Verification steps

. Investigate the {prod-short} logs:
+
[subs="+attributes"]
----
$ {prod-cli} server:logs --namespace {prod-namespace}
----

. Verify that the certificate settings are correct.
.. Open {prod} server URL from the output of the previous command.
.. Click on the lock icon in the address bar.
.. Verify that the pop-up window displays the **Connection is secure** message.

.Additional resources

* xref:end-user-guide:navigating-che-using-the-dashboard.adoc[].
