:parent-context-of-customize-chehost: {context}

[id="customize-chehost_{context}"]
= Configuring {prod} server hostname

:context: customize-chehost

This procedure describes how to configure {prod-short} to use custom hostname.

.Prerequisites

* The `{orch-cli}` tool is available.
* The certificate and the private key files are generated.

IMPORTANT: To generate the pair of a private key and certificate, the same certification authority (CA) must be used as for other {prod-short} hosts.

IMPORTANT: Ask a DNS provider to point the custom hostname to the cluster ingress.

[id="configuring-ingresses_{context}"]
= Configuring {orch-ingress}

By configuring labels and annotations for {orch-ingress} you can organize and categorize objects by scoping and selecting.

.Prerequisites

* The `{orch-cli}` tool is available.
* An instance of {prod-short} running in {orch-name}.

.Procedure

. To configure labels for {orch-ingress}, update the Custom Resource:
+
IMPORTANT: Use commas to separate labels: `key1=value1,key2=value2`.
+
[subs="+quotes,+attributes"]
----
$ {orch-cli} patch checluster/{prod-checluster} -n {prod-namespace} --type=json -p \
'[{"op": "replace", "path": "/spec/server/cheServerIngress/labels", '\
'"value": "__<labels for a {prod-id-short} server ingress>__"}]'

$ {orch-cli} patch checluster/{prod-checluster} -n {prod-namespace} --type=json -p \
'[{"op": "replace", "path": "/spec/auth/identityProviderIngress/labels", '\
'"value": "__<labels for a {identity-provider} ingress>__"}]'

$ {orch-cli} patch checluster/{prod-checluster} -n {prod-namespace} --type=json -p \
'[{"op": "replace", "path": "/spec/server/pluginRegistryIngress/labels", '\
'"value": "__<labels for a plug-ins registry ingress>__"}]'

$ {orch-cli} patch checluster/{prod-checluster} -n {prod-namespace} --type=json -p \
'[{"op": "replace", "path": "/spec/server/devfileRegistryIngress/labels",'\
'"value": "__<labels for a devfile registry ingress>__"}]'

$ {orch-cli} patch checluster/{prod-checluster} -n {prod-namespace} --type=json -p \
'[{"op": "replace", "path": "/spec/server/dashboardIngress/labels",'\
'"value": "__<labels for a dashboard ingress>__"}]'

$ {orch-cli} patch checluster/{prod-checluster} -n {prod-namespace} --type=json -p \
'[{"op": "replace", "path": "/spec/server/customCheProperties/CHE_INFRA_KUBERNETES_INGRESS_LABELS", '\
'"value": "__<labels for a workspace ingress>__"}]'
----
. To configure annotations for {orch-ingress}, update the Custom Resource with the following commands:
+
IMPORTANT: Use objects to specify annotations: `{"key1": "value1", "key2" : "value2"}`.
+
[subs="+quotes,+attributes"]
----
$ {orch-cli} patch checluster/{prod-checluster} -n {prod-namespace} --type=json -p \
'[{"op": "replace", "path": "/spec/server/cheServerIngress/annotations", '\
'"value": __<annotations for a {prod-id-short} server ingress>__}]'

$ {orch-cli} patch checluster/{prod-checluster} -n {prod-namespace} --type=json -p \
'[{"op": "replace", "path": "/spec/auth/identityProviderIngress/annotations", '\
'"value": __<annotations for a {identity-provider} ingress>__}]'

$ {orch-cli} patch checluster/{prod-checluster} -n {prod-namespace} --type=json -p \
'[{"op": "replace", "path": "/spec/server/pluginRegistryIngress/annotations", '\
'"value": __<annotations for a plug-ins registry ingress>__}]'

$ {orch-cli} patch checluster/{prod-checluster} -n {prod-namespace} --type=json -p \
'[{"op": "replace", "path": "/spec/server/devfileRegistryIngress/annotations",'\
'"value": __<annotations for a devfile registry ingress>__}]'

$ {orch-cli} patch checluster/{prod-checluster} -n {prod-namespace} --type=json -p \
'[{"op": "replace", "path": "/spec/server/dashboardIngress/annotations",'\
'"value": __<annotations for a dashboard ingress>__}]'

$ {orch-cli} patch checluster/{prod-checluster} -n {prod-namespace} --type=json -p \
'[{"op": "replace", "path": "/spec/server/customCheProperties/CHE_INFRA_KUBERNETES_INGRESS_ANNOTATIONS______JSON", '\
'"value": "__<annotations for a workspace ingress in json format>__"}]'
----

.Procedure

. Pre-create a {orch-namespace} for {prod-short}:
+
[subs="+quotes,attributes"]
----
$ {orch-cli} create {orch-namespace} {prod-namespace}
----

. Create a TLS secret:
+
[subs="+quotes,attributes"]
----
$ {orch-cli} create secret TLS $\{secret} \  <1>
--key $\{key_file} \                       <2>
--cert $\{cert_file} \                     <3>
-n {prod-namespace}
----
<1> The TLS secret name
<2> A file with the private key
<3> A file with the certificate


. Set the following values in the Custom Resource:
+
[subs="+quotes,+attributes"]
----
spec:
  server:
    cheHost: <hostname>         <1>
    cheHostTLSSecret: <secret>  <2>
----
<1> Custom {prod} server hostname
<2> The TLS secret name

. If {prod-short} has been already deployed, wait until the rollout of all {prod-short} components finishes.

:context: {parent-context-of-customize-chehost}
